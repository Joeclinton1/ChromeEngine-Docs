<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/ChromeEngine-Docs/blog/rss.xml" title="ChromeEngine Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ChromeEngine-Docs/blog/atom.xml" title="ChromeEngine Documentation Blog Atom Feed"><title data-react-helmet="true">Tree Generation | ChromeEngine Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Tree Generation"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Tree Generation | ChromeEngine Documentation"><meta data-react-helmet="true" name="description" content="This document provides detailed explanations for the custom block definitions used in the &quot;Tree Generation&quot; page of the &quot;Binary Space Partitioning&quot; docs. The code you&#x27;ll be looking at was developed for a scratch based 3D engine called ChromeEngine."><meta data-react-helmet="true" property="og:description" content="This document provides detailed explanations for the custom block definitions used in the &quot;Tree Generation&quot; page of the &quot;Binary Space Partitioning&quot; docs. The code you&#x27;ll be looking at was developed for a scratch based 3D engine called ChromeEngine."><link data-react-helmet="true" rel="shortcut icon" href="/ChromeEngine-Docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Tree Generation"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Tree Generation" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Tree Generation" hreflang="x-default"><link rel="stylesheet" href="/ChromeEngine-Docs/assets/css/styles.b2352ca9.css">
<link rel="preload" href="/ChromeEngine-Docs/assets/js/runtime~main.7f1e69ab.js" as="script">
<link rel="preload" href="/ChromeEngine-Docs/assets/js/main.22ee48c8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ChromeEngine-Docs/"><img src="/ChromeEngine-Docs/img/logo.svg" alt="ChromeEngine Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/ChromeEngine-Docs/img/logo.svg" alt="ChromeEngine Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">ChromeEngine</b></a><a class="navbar__item navbar__link" href="/ChromeEngine-Docs/docs/tutorials/Platformer Tutorial/Intro">Tutorials</a><a class="navbar__item navbar__link" href="/ChromeEngine-Docs/docs/user_docs/Intro">User Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/ChromeEngine-Docs/docs/system_docs/Intro">System Docs</a><a class="navbar__item navbar__link" href="/ChromeEngine-Docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/your-github-username/your-repo-name" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ChromeEngine-Docs/docs/system_docs/Intro">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">BSP</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Prims">_*prims</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Tree Generation">Tree Generation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Tree Traversal">Tree Traversal</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Dynamic Objects">Subtrees for dynamic objects</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Physics</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Tree Generation</h1></header><p>This document provides detailed explanations for the custom block definitions used in the &quot;Tree Generation&quot; page of the &quot;Binary Space Partitioning&quot; docs. The code you&#x27;ll be looking at was developed for a scratch based 3D engine called ChromeEngine.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="custom-block-definitions"></a>Custom Block Definitions<a class="hash-link" href="#custom-block-definitions" title="Direct link to heading">#</a></h2><p>The custom block definitions are as follows:</p><ul><li><code>bsp.__init__</code></li><li><code>bsp.gen</code></li><li><code>bsp.recurse on low&amp;up</code></li><li><code>bsp.partition</code></li><li><code>bsp.greedy_pivot_selection</code></li><li><code>test_prim_as_pivot</code></li><li><code>get_orientation_of_*poly_to_plane (P, N)</code></li><li><code>primitives.split_prim</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="custom-block-descriptions"></a>Custom Block Descriptions<a class="hash-link" href="#custom-block-descriptions" title="Direct link to heading">#</a></h2><p>Now we&#x27;ll provide detailed descriptions for each of these custom blocks, including the converted ScratchBlocks code and an explanation of the logic within each block.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsp__init__"></a><code>bsp.__init__</code><a class="hash-link" href="#bsp__init__" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.__init__ \( \)
</pre><p>This block initializes the Binary Space Partitioning (BSP) tree. It starts by creating two lists, <code>_bsp.node_tombstones[]</code> and <code>bsp.tree[]</code>, which will hold the tombstones for nodes and the tree structure respectively. It then adds two nodes to <code>bsp.tree[]</code> for initialization. <code>tmp[]</code> is also initialized with nine 0s. The <code>_split_count</code> variable is set to 0, which will track the number of splits made during the tree generation. Lastly, <code>bsp._*prims.__init_non_dynamic__()</code> is called to initialize the primitives with non-dynamic variables.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bspgen"></a><code>bsp.gen</code><a class="hash-link" href="#bspgen" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.gen \( (lowerBound) (upperBound) (parent_node) (right?) \)
</pre><p>This block is responsible for generating the BSP tree. It begins by checking if the <code>lowerBound</code> and <code>upperBound</code> are null, or if the upper bound is equal to the lower bound in the primitives array, if so, it returns without performing any actions. This ensures that we have a valid range to work with. The block then selects a pivot by calling <code>bsp.greedy_pivot_selection</code> and if a pivot can&#x27;t be found, it adds a node to the BSP tree with the <code>lowerBound</code> and <code>upperBound</code> as the node limits. However, if a pivot is found, the function checks if the <code>upperBound</code> and <code>lowerBound</code> are not the same, and if so, it partitions the prims into two groups by calling <code>bsp.partition</code>. It then groups the primitives by their orientation and adds a node to the BSP tree with the gathered data. The block also sets the parent node&#x27;s edge to the newly created node, if the parent node is not null. The function then checks if the <code>upperBound</code> equals the <code>lowerBound</code> or if the pivot is null, and if either condition is true, it returns without proceeding further. If not, it calls the <code>bsp.recurse on low&amp;up</code> function for further processing.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsprecurse-on-lowup"></a><code>bsp.recurse on low&amp;up</code><a class="hash-link" href="#bsprecurse-on-lowup" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.recurse on low&amp;up \( (lowerBound) (*pivot_list_head) (*pivot_list_tail) (upperBound) (*parent_node) \)
</pre><p>This block is used to recursively generate the BSP tree. It calls the <code>bsp.gen</code> function twice - first for the lower partition, and then for the upper partition. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsppartition"></a><code>bsp.partition</code><a class="hash-link" href="#bsppartition" title="Direct link to heading">#</a></h3><pre class="blocks">

define _upper, _*pivot_prims_tail = bsp.partition \( (L) (U) \)
</pre><p>This block partitions the list of primitives into two parts - primitives in front of the pivot plane and those behind the pivot plane. It accepts the <code>lowerBound</code> (L) and <code>upperBound</code> (U) as inputs. It initializes <code>_pivot_prims_head</code> to <code>L</code> and <code>_pivot_prims_tail</code> to <code>U</code>, and <code>_upper</code> to <code>L</code>. The function then iterates over the primitives in the range <code>[L, U]</code> and for each primitive, it calls <code>test_prim_as_pivot</code> to test if the primitive can be used as a pivot. If it can&#x27;t be used as a pivot, it increments <code>_pivot_prims_tail</code> and moves the primitive at <code>_upper</code> to <code>_pivot_prims_tail</code>, effectively moving it to the end of the pivot prims list. If it can be used as a pivot, it moves the primitive at <code>_pivot_prims_tail</code> to <code>_upper</code>, effectively moving it to the front of the list, and increments <code>_upper</code>. The block ends by returning <code>_upper</code> and <code>_pivot_prims_tail</code>, which now represent the boundaries of the prims that can be used as pivots.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bspgreedy_pivot_selection"></a><code>bsp.greedy_pivot_selection</code><a class="hash-link" href="#bspgreedy_pivot_selection" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.greedy_pivot_selection \( (lowerBound) (upperBound) \)
</pre><p>This block selects a pivot prims for partitioning the primitives list. It accepts the <code>lowerBound</code> and <code>upperBound</code> as inputs. The block first calculates the middle index in the range <code>[lowerBound, upperBound]</code> and if the primitive at the middle index can be used as a pivot (determined by calling <code>test_prim_as_pivot</code>), it returns this primitive as the pivot. If it can&#x27;t be used as a pivot, the block iterates over the primitives in the range <code>[lowerBound, upperBound]</code>, in order, and returns the first primitive it finds that can be used as a pivot. If no pivot can be found, it returns null.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="test_prim_as_pivot"></a><code>test_prim_as_pivot</code><a class="hash-link" href="#test_prim_as_pivot" title="Direct link to heading">#</a></h3><pre class="blocks">

define test_prim_as_pivot \( (*pivot) (L) (U) \)
</pre><p>This block tests whether a primitive can be used as a pivot or not. It accepts the primitive to test (<code>pivot</code>), and the <code>lowerBound</code> (L) and <code>upperBound</code> (U) of the range in which to test the primitive. The function iterates over the primitives in the range <code>[L, U]</code> and for each primitive, it calls <code>get_orientation_of_*poly_to_plane (P, N)</code> to get its orientation with respect to the pivot. If the primitive&#x27;s orientation is such that it is on the same side as the pivot, it increments a counter. If the number of primitives that are on the same side as the pivot is greater than a threshold (for example, 90% of the primitives), it returns true, indicating that the primitive can be used as a pivot. Otherwise, it returns false.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="_node_curr-_ori-_intersects--get_orientation_of_poly_to_plane-p-n"></a><code>_node_curr, _ori, _intersects = get_orientation_of_*poly_to_plane (P, N)</code><a class="hash-link" href="#_node_curr-_ori-_intersects--get_orientation_of_poly_to_plane-p-n" title="Direct link to heading">#</a></h3><pre class="blocks">

define _node_curr, _ori, _intersects = get_orientation_of_*poly_to_plane \( (P, N) *poly (*poly) plane (P,N) (Px) (Py) (Pz) (Nx) (Ny) (Nz) do split? &lt;do_split?&gt; **Prim (**prim) \)
</pre><p>This custom block calculates the orientation of a polygon with respect to a plane and tests if the polygon intersects the plane. The block accepts the polygon (<code>*poly</code>), the definition of the plane (<code>Px, Py, Pz, Nx, Ny, Nz</code> which represent the point and normal of the plane), a boolean indicating whether to split the polygon if it intersects the plane (<code>do_split?</code>), and the primitive to use if a split is required (<code>**Prim</code>). </p><p>Initially, the block initializes <code>_intersects?</code> to <code>0</code> indicating no intersection and <code>_count</code> to track the number of vertices processed. It extracts the first vertex index of the polygon and calculates the dot product of the plane&#x27;s normal and the vector from a point on the plane to this vertex (<code>_dot</code>). This value (<code>_dot_curr</code>) is used to determine the sign of the vertex with respect to the plane. This process is iterated for each vertex of the polygon in a loop. If the sign of a vertex is different from the sign of the previous vertex, this indicates a potential intersection. </p><p>In case of an intersection, if <code>do_split?</code> is set to true, the polygon is split by adding two new vertices at the intersection points and creating a new primitive for the second half of the split polygon. The new primitive is inserted into <code>bsp._*prims</code>. If <code>do_split?</code> is set to false, the function terminates and returns. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="_prim--primitivessplit_prim--prim-intersecta-intersectb-"></a><code>_*prim = primitives.split_prim ( *prim, *intersectA, *intersectB )</code><a class="hash-link" href="#_prim--primitivessplit_prim--prim-intersecta-intersectb-" title="Direct link to heading">#</a></h3><pre class="blocks">

define _*prim = primitives.split_prim \( *prim (*prim) *intersectA (*A) *intersectB (*B) \)
</pre><p>This custom block splits a primitive into two at the given intersection points. The block takes as input the primitive to split (<code>*prim</code>), and two intersection points (<code>*intersectA</code>, <code>*intersectB</code>). </p><p>The process of splitting involves changing the connectivity of vertices in the polygon by inserting new vertices at the intersection points. The first intersection point is inserted after the vertex indexed by <code>*intersectA</code> and the second intersection point is inserted after the vertex indexed by <code>*intersectB</code>. The links between vertices are updated to ensure the continuity of the polygons after the split. </p><p>A new primitive is then created for the second half of the split polygon. This new primitive shares the same attributes as the original primitive but has a different set of vertices. The primitive count <code>_split_count</code> is incremented as well.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/your-github-username/your-repo-name/edit/main/docs/docs/system_docs/01-BSP/02-Tree Generation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ChromeEngine-Docs/docs/system_docs/BSP/Prims"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« _*prims</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ChromeEngine-Docs/docs/system_docs/BSP/Tree Traversal"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tree Traversal Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#custom-block-definitions" class="table-of-contents__link">Custom Block Definitions</a></li><li><a href="#custom-block-descriptions" class="table-of-contents__link">Custom Block Descriptions</a><ul><li><a href="#bsp__init__" class="table-of-contents__link"><code>bsp.__init__</code></a></li><li><a href="#bspgen" class="table-of-contents__link"><code>bsp.gen</code></a></li><li><a href="#bsprecurse-on-lowup" class="table-of-contents__link"><code>bsp.recurse on low&amp;up</code></a></li><li><a href="#bsppartition" class="table-of-contents__link"><code>bsp.partition</code></a></li><li><a href="#bspgreedy_pivot_selection" class="table-of-contents__link"><code>bsp.greedy_pivot_selection</code></a></li><li><a href="#test_prim_as_pivot" class="table-of-contents__link"><code>test_prim_as_pivot</code></a></li><li><a href="#_node_curr-_ori-_intersects--get_orientation_of_poly_to_plane-p-n" class="table-of-contents__link"><code>_node_curr, _ori, _intersects = get_orientation_of_*poly_to_plane (P, N)</code></a></li><li><a href="#_prim--primitivessplit_prim--prim-intersecta-intersectb-" class="table-of-contents__link"><code>_*prim = primitives.split_prim ( *prim, *intersectA, *intersectB )</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/docs/tutorials/Platformer Tutorial/Intro">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/docs/user_docs/Intro">User Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/docs/system_docs/Intro">System Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://scratch.mit.edu/users/Chrome_Cat/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scratch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/your-github-username/your-repo-name" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 ChromeEngine</div></div></div></footer></div>
<script src="/ChromeEngine-Docs/assets/js/runtime~main.7f1e69ab.js"></script>
<script src="/ChromeEngine-Docs/assets/js/main.22ee48c8.js"></script>
</body>
</html>