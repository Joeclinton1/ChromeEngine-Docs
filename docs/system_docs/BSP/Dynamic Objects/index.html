<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/ChromeEngine-Docs/blog/rss.xml" title="ChromeEngine Documentation Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ChromeEngine-Docs/blog/atom.xml" title="ChromeEngine Documentation Blog Atom Feed"><title data-react-helmet="true">Subtrees for dynamic objects | ChromeEngine Documentation</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Dynamic Objects"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Subtrees for dynamic objects | ChromeEngine Documentation"><meta data-react-helmet="true" name="description" content="Since ChromeEngine uses BSP for it&#x27;s sorting traditionally the limitation is you can only have static scenes supported, however in ChromeEngine we&#x27;ve gone to great lengths to provide a workaround for dynamic objects. Our solution is called &quot;BSP subtrees&quot;. And we&#x27;ll walk you through how they work."><meta data-react-helmet="true" property="og:description" content="Since ChromeEngine uses BSP for it&#x27;s sorting traditionally the limitation is you can only have static scenes supported, however in ChromeEngine we&#x27;ve gone to great lengths to provide a workaround for dynamic objects. Our solution is called &quot;BSP subtrees&quot;. And we&#x27;ll walk you through how they work."><link data-react-helmet="true" rel="shortcut icon" href="/ChromeEngine-Docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Dynamic Objects"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Dynamic Objects" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://your-docusaurus-test-site.com/ChromeEngine-Docs/docs/system_docs/BSP/Dynamic Objects" hreflang="x-default"><link rel="stylesheet" href="/ChromeEngine-Docs/assets/css/styles.b2352ca9.css">
<link rel="preload" href="/ChromeEngine-Docs/assets/js/runtime~main.0466f7aa.js" as="script">
<link rel="preload" href="/ChromeEngine-Docs/assets/js/main.22ee48c8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ChromeEngine-Docs/"><img src="/ChromeEngine-Docs/img/logo.svg" alt="ChromeEngine Logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/ChromeEngine-Docs/img/logo.svg" alt="ChromeEngine Logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">ChromeEngine</b></a><a class="navbar__item navbar__link" href="/ChromeEngine-Docs/docs/tutorials/Platformer Tutorial/Intro">Tutorials</a><a class="navbar__item navbar__link" href="/ChromeEngine-Docs/docs/user_docs/Intro">User Docs</a><a class="navbar__item navbar__link navbar__link--active" href="/ChromeEngine-Docs/docs/system_docs/Intro">System Docs</a><a class="navbar__item navbar__link" href="/ChromeEngine-Docs/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/your-github-username/your-repo-name" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" href="/ChromeEngine-Docs/docs/system_docs/Intro">Intro</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">BSP</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Prims">_*prims</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Tree Generation">Tree Generation</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Tree Traversal">Tree Traversal</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ChromeEngine-Docs/docs/system_docs/BSP/Dynamic Objects">Subtrees for dynamic objects</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Physics</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Subtrees for dynamic objects</h1></header><p>Since ChromeEngine uses BSP for it&#x27;s sorting traditionally the limitation is you can only have static scenes supported, however in ChromeEngine we&#x27;ve gone to great lengths to provide a workaround for dynamic objects. Our solution is called &quot;BSP subtrees&quot;. And we&#x27;ll walk you through how they work.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="what-are-subtrees"></a>What are subtrees?<a class="hash-link" href="#what-are-subtrees" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="reinserting-point-primitives"></a>Reinserting point primitives<a class="hash-link" href="#reinserting-point-primitives" title="Direct link to heading">#</a></h3><p>Re-inserting a point into a BSP tree is always O(log n) time complexity and easy to do. Here&#x27;s how we do it:</p><ol><li>Point primitives are always leaf nodes of the BSP tree</li><li>So removing a point primitive node from the tree is as simple as snipping off the leaf</li><li>Finally to complete the reinsertion we just insert the point into the tree by performing a fast traversal specific to points, without any split checks.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="subtrees-for-dynamic-objects-contained-within-point-primitives"></a>Subtrees for dynamic objects contained within point primitives<a class="hash-link" href="#subtrees-for-dynamic-objects-contained-within-point-primitives" title="Direct link to heading">#</a></h3><p>if we can sort point primitives into a bsp tree could we simply tree a models tree as point and then sort an entire object into the scene? Yes! To do this we introduce a new primitive called a <code>container</code> and we introduce the idea of <code>dynamic objects</code>. Here&#x27;s what we do:</p><ol><li>Mark objects as being <code>dynamic</code></li><li>Generate each <code>dynamic object</code> their own subtree</li><li>Create a <code>container primitive</code> for the dynamic object, which is treated as point primitive except also points to a subtree.</li><li>We can now insert this contain primitive into the main tree, and when it is reached during traversal we recursively traverse it&#x27;s subtree.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="the-big-downside-with-dynamic-objects"></a>The big downside with <code>Dynamic objects</code><a class="hash-link" href="#the-big-downside-with-dynamic-objects" title="Direct link to heading">#</a></h3><p>Dynamic objects work great in alot of cases, but the problem is since we tree the object as a point and don&#x27;t split any primitives, there&#x27;s a possibility that the objects primitives will be sorted wrong and this can cause visual bugs. We are trying to solve this but it&#x27;s not easy.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_y2LR" id="custom-block-descriptions"></a>Custom Block Descriptions<a class="hash-link" href="#custom-block-descriptions" title="Direct link to heading">#</a></h2><p>These are the custom blocks in ChromeEngine which deal with dynamic objects:</p><ol><li><code>handle_dynamic_objects</code></li><li><code>bsp.tree.insert_prim</code></li><li><code>bsp.tree.try_to_insert_in_container</code></li><li><code>bsp.tree.reinsert_updated_objects</code></li><li><code>bsp.tree.remove_leaf_node</code></li><li><code>bsp.tree.remove_prim_from_node</code></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="handle_dynamic_objects"></a><code>handle_dynamic_objects</code><a class="hash-link" href="#handle_dynamic_objects" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.handle_dynamic_objects \( \)
</pre><ol><li>Creates a root node if the tree is empty<ol><li>this only occurs if all objects are marked as dynamic</li></ol></li><li>Iterate over all the gameobjects and for each object marked as dynamic add it to the <code>@dynamic_objects</code> list and to the <code>_dynamic_obj_queue</code></li><li>Whilst <code>_dynamic_obj_queue</code> still has items:<ol><li>Pop off the first object <code>_*obj</code> off the queue</li><li>If <code>_*obj</code> is not contained within the main tree (aka is a child of a dynamic object) and it&#x27;s parent dynamic object has not been generated yet, add it back to the queue and go back to step 1.</li><li>Create a new vertex to denote the centre of the <code>container</code> primitive. The position is equal to the bounding sphere of <code>_*obj</code>&#x27;s centre coordinate plus the dynamic offset vector.</li><li>For each primitive assigned to <code>_*obj</code> insert pointers to them at the end of the <code>_*prims</code> list. <code>_lower</code> and <code>_**prim</code> are pointers to the start and end of the newly added sublist of <code>_*prims</code>.</li><li>Generate a BSP subtree using this sublist.</li><li>Create a <code>container</code> primitive using the previously created vertex, the radius of the dynamic objects bounding sphere and a pointer to the newly created subtree. Insert this <code>container</code> primitive into the main tree or the subtree assigned to the dynamic object using <code>bsp.tree.insert_prim</code></li></ol></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsptreeinsert_prim"></a><code>bsp.tree.insert_prim</code><a class="hash-link" href="#bsptreeinsert_prim" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.tree.insert_prim \((_*prim)(old_**prim)(*root)(orientation) level (level) local_var_stack (stack:current)\)
</pre><p>Performs the insertion of a primitive into a tree. The steps are:</p><ol><li>Traverse the tree until we reach a point primitive node or a leaf node to find where the point primitive pointed to by <code>_*prim</code> should be inserted</li><li>If the current node is Empty, then we reached a leaf node which is assigned to a polygon:<ol><li>insert the primitive pointer into the <code>_*prims</code> list at the end</li><li>Create a new leaf node as a child of the leaf node to store our new primitive. Whether it&#x27;s a left or right node depends on orientation.</li></ol></li><li>Else:<ol><li>Try to insert the primitive into a <code>container</code> primitive in case there is one using <code>bsp.tree.try_to_insert_in_container</code>.</li><li>If our current node was previously node (which we can tell since it would&#x27;ve been marked as a TOMBSTONE) then insert our primitive pointer into the <code>_*prims</code> list at the end</li><li>Else insert our primitive pointer in the same location as the first point primitive stored by the current node.</li></ol></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsptreetry_to_insert_in_container"></a><code>bsp.tree.try_to_insert_in_container</code><a class="hash-link" href="#bsptreetry_to_insert_in_container" title="Direct link to heading">#</a></h3><pre class="blocks">

define _tmp = bsp.tree.try_to_insert_in_container \( *prim (*prim) old_**prim (old_**prim) orientation (orientation) level (level) \)
</pre><p>Iterates over the point primitives stored in a given BSP tree node (it assumes <code>_current</code> is set to the current node), and checks if they are containers. If there&#x27;s more than one container it finds the closest container (by bounding sphere distance) to the primitive being inserted. If any container was found it inserts the primitive into it. It sets <code>_tmp</code> to 1 if it was successful else 0.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsptreereinsert_updated_objects"></a><code>bsp.tree.reinsert_updated_objects</code><a class="hash-link" href="#bsptreereinsert_updated_objects" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.tree.reinsert_updated_objects
</pre><ol><li>For each updated object which is dynamic:<ol><li>remove the primitive from it&#x27;s BSP tree node using <code>bsp.tree.remove_prim_from_node</code></li><li>pop it&#x27;s prim pointer from <code>prims</code></li><li>insert the primitive back into the tree using <code>bsp.tree.insert_prim</code></li></ol></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsptreeremove_prim_from_node"></a><code>bsp.tree.remove_prim_from_node</code><a class="hash-link" href="#bsptreeremove_prim_from_node" title="Direct link to heading">#</a></h3><pre class="blocks">

define _**prim = bsp.remove_prim_from_node \((*node) (*prim)\)
</pre><ol><li>If <code>_*prim</code> is the only primitive in it&#x27;s tree node then call <code>bsp.tree.remove_leaf_node</code> to snip off the leaf node (we can assume it&#x27;s a leaf node as we only reinsert point primitives which are always leaves)</li><li>Else:<ol><li>Find the index of <code>_*prim</code> in the sublist of <code>_*prims</code> assigned to the tree node and then adjust the BSP tree to not include it. Note: we don&#x27;t remove the primitive, from the list as we&#x27;re going to add it back anyway and we don&#x27;t want to waste computation.</li></ol></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_y2LR" id="bsptreeremove_leaf_node"></a><code>bsp.tree.remove_leaf_node</code><a class="hash-link" href="#bsptreeremove_leaf_node" title="Direct link to heading">#</a></h3><pre class="blocks">

define bsp.remove_leaf_node \((*node)\)
</pre><p>Removes a leaf node by removing all references to it within the bsp.tree.</p><ol><li>Remove edges to the node</li><li>If the node is at the end of the <code>bsp.tree</code> list simply delete the data, otherwise to preserve pointers just assign the first item of data to be TOMBSTONE to mark that it was deleted.</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/your-github-username/your-repo-name/edit/main/docs/docs/system_docs/01-BSP/04-Dynamic Objects.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ChromeEngine-Docs/docs/system_docs/BSP/Tree Traversal"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Tree Traversal</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ChromeEngine-Docs/docs/system_docs/Physics/BoundingSpheres"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Bounding Spheres Generation Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-subtrees" class="table-of-contents__link">What are subtrees?</a><ul><li><a href="#reinserting-point-primitives" class="table-of-contents__link">Reinserting point primitives</a></li><li><a href="#subtrees-for-dynamic-objects-contained-within-point-primitives" class="table-of-contents__link">Subtrees for dynamic objects contained within point primitives</a></li><li><a href="#the-big-downside-with-dynamic-objects" class="table-of-contents__link">The big downside with <code>Dynamic objects</code></a></li></ul></li><li><a href="#custom-block-descriptions" class="table-of-contents__link">Custom Block Descriptions</a><ul><li><a href="#handle_dynamic_objects" class="table-of-contents__link"><code>handle_dynamic_objects</code></a></li><li><a href="#bsptreeinsert_prim" class="table-of-contents__link"><code>bsp.tree.insert_prim</code></a></li><li><a href="#bsptreetry_to_insert_in_container" class="table-of-contents__link"><code>bsp.tree.try_to_insert_in_container</code></a></li><li><a href="#bsptreereinsert_updated_objects" class="table-of-contents__link"><code>bsp.tree.reinsert_updated_objects</code></a></li><li><a href="#bsptreeremove_prim_from_node" class="table-of-contents__link"><code>bsp.tree.remove_prim_from_node</code></a></li><li><a href="#bsptreeremove_leaf_node" class="table-of-contents__link"><code>bsp.tree.remove_leaf_node</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/docs/tutorials/Platformer Tutorial/Intro">Tutorials</a></li><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/docs/user_docs/Intro">User Docs</a></li><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/docs/system_docs/Intro">System Docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://scratch.mit.edu/users/Chrome_Cat/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Scratch<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ChromeEngine-Docs/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/your-github-username/your-repo-name" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 ChromeEngine</div></div></div></footer></div>
<script src="/ChromeEngine-Docs/assets/js/runtime~main.0466f7aa.js"></script>
<script src="/ChromeEngine-Docs/assets/js/main.22ee48c8.js"></script>
</body>
</html>